import React, { useEffect, useState } from "react";
import { ApplyPluginsType } from "umi";
import { renderClient } from "D:/nvm/v18.18.2/node_modules/umi/node_modules/@umijs/renderer-react";
import { createHistory } from "./core/history";
import { createPluginManager } from "./core/plugin";
import { getRoutes } from "./core/route";
const publicPath = "/";
const runtimePublicPath = false;
export function TestBrowser(props) {
  const pluginManager = createPluginManager();
  const [context, setContext] = useState(
    void 0
  );
  useEffect(() => {
    const genContext = async () => {
      const { routes, routeComponents } = await getRoutes(pluginManager);
      await pluginManager.applyPlugins({
        key: "patchRoutes",
        type: ApplyPluginsType.event,
        args: {
          routes,
          routeComponents
        }
      });
      const contextOpts = pluginManager.applyPlugins({
        key: "modifyContextOpts",
        type: ApplyPluginsType.modify,
        initialValue: {}
      });
      const basename = contextOpts.basename || "/";
      const history = createHistory({
        type: "memory",
        basename
      });
      const context2 = {
        routes,
        routeComponents,
        pluginManager,
        rootElement: contextOpts.rootElement || document.getElementById("root"),
        publicPath,
        runtimePublicPath,
        history,
        basename,
        components: true
      };
      const modifiedContext = pluginManager.applyPlugins({
        key: "modifyClientRenderOpts",
        type: ApplyPluginsType.modify,
        initialValue: context2
      });
      return modifiedContext;
    };
    genContext().then((context2) => {
      setContext(context2);
      if (props.location) {
        context2?.history?.push(props.location);
      }
      if (props.historyRef) {
        props.historyRef.current = context2?.history;
      }
    });
  }, []);
  if (context === void 0) {
    return /* @__PURE__ */ React.createElement("div", { id: "loading" });
  }
  const Children = renderClient(context);
  return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement(Children, null));
}
